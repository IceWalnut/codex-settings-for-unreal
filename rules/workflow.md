# Codex Workflow Rules (Global)

目标：可预测、可回滚、少打扰、一次做对。

## Required process
1. Clarify scope (仅在确实不明确时)
   - 如果用户目标清晰：直接开始。
   - 如果存在关键歧义：给出“默认假设 + 备选方案”，不要反复追问。

2. Search first
   - 默认使用 `rg` / `rg --files`。
   - 先定位入口（调用链、配置、路由、模块边界），再动手改。

3. Plan before edits
   - 给一个 3~6 行的短计划：改哪些文件、为什么、风险点、验证方式。
   - 避免“边想边改”导致的大范围扩散。

4. Minimal, localized diff
   - 只改与目标直接相关的代码。
   - 不做无关重构、不做大范围格式化、不改未触及的命名风格。

5. Batch changes coherently
   - 一个逻辑改动对应一组相关文件一次性改完：
     - 代码 + 测试/验证脚本 + 文档/注释（必要时）
   - 避免“改一行就停一下/提交一下”的碎片化。

6. Validate (if possible)
   - 优先使用仓库已有脚本/命令：
     - build、test、lint、format、packaging。
   - 如果环境不允许运行：
     - 明确说明无法验证，并给出用户可执行的验证步骤。

7. Output format (默认)
   - 先给短计划
   - 再给补丁/具体修改点（文件+关键 diff）
   - 再给验证命令
   - 最后给风险/回滚点（如需要）

## Guardrails
- 不要为了“看起来更优雅”而改动无关代码。
- 不要引入新的依赖，除非用户要求或现有依赖明确不足。
- 不要吞错；遇到不确定的行为要显式处理或暴露错误。
